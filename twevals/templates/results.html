<table id="results-table" class="min-w-full divide-y divide-gray-200 shadow ring-1 ring-black ring-opacity-5 rounded-lg overflow-hidden">
  <thead>
    <tr class="bg-gray-50">
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer select-none" data-col="function">Function</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer select-none" data-col="dataset">Dataset</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer select-none" data-col="labels">Labels</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer select-none" data-col="input">Input</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer select-none" data-col="output">Output</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer select-none" data-col="error">Error</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer select-none" data-col="status" data-type="number">Pass</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer select-none" data-col="latency" data-type="number">Latency</th>
    </tr>
  </thead>
  <tbody class="bg-white divide-y divide-gray-100">
    {% for r in summary.results %}
    <tr class="odd:bg-white even:bg-gray-50 hover:bg-blue-50">
      <td class="px-4 py-2 text-sm font-mono text-sky-700" data-col="function">{{ r.function }}</td>
      <td class="px-4 py-2 text-sm text-gray-700" data-col="dataset">{{ r.dataset }}</td>
      <td class="px-4 py-2 text-sm text-gray-800" data-col="labels">
        {% if r.labels %}
          {% for la in r.labels %}
            <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 text-xs mr-1">{{ la }}</span>
          {% endfor %}
        {% endif %}
      </td>
      <td class="px-4 py-2 text-sm text-gray-800 max-w-[36ch] whitespace-nowrap overflow-hidden text-ellipsis" data-col="input">{{ r.result.input }}</td>
      <td class="px-4 py-2 text-sm text-gray-800 max-w-[36ch] whitespace-nowrap overflow-hidden text-ellipsis" data-col="output">{{ r.result.output }}</td>
      <td class="px-4 py-2 text-sm" data-col="error">
        {% if r.result.error %}
          <span class="text-red-600">{{ r.result.error }}</span>
        {% else %}
          <span class="text-gray-400">—</span>
        {% endif %}
      </td>
      {# Pass/Fail derived from scores #}
      {% set ns = namespace(passed=None) %}
      {% if r.result.scores %}
        {% for s in r.result.scores %}
          {% if s.passed is true %}
            {% set ns.passed = true %}
          {% elif s.passed is false and ns.passed is not true %}
            {% set ns.passed = false %}
          {% endif %}
        {% endfor %}
      {% endif %}
      <td class="px-4 py-2 text-sm" data-col="status" data-value="{% if ns.passed is true %}1{% elif ns.passed is false %}0{% endif %}">
        {% if ns.passed is true %}
          <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-green-100 text-green-800">Pass</span>
        {% elif ns.passed is false %}
          <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-red-100 text-red-800">Fail</span>
        {% else %}
          <span class="text-gray-400">—</span>
        {% endif %}
      </td>
      <td class="px-4 py-2 text-sm whitespace-nowrap" data-col="latency" data-value="{% if r.result.latency is not none %}{{ r.result.latency }}{% endif %}">
        {% if r.result.latency is not none %}
          {% set latency = r.result.latency %}
          {% set label = latency | round(2) %}
          {% if latency <= 0.5 %}
            <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-green-100 text-green-800">{{ label }}s</span>
          {% elif latency <= 1.5 %}
            <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-800">{{ label }}s</span>
          {% else %}
            <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-red-100 text-red-800">{{ label }}s</span>
          {% endif %}
        {% else %}
          <span class="text-gray-400">—</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
