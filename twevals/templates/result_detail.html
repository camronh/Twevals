<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ result.function }} - twevals</title>
    <link rel="icon" type="image/png" href="/static/logo.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'ui-sans-serif', 'system-ui', 'Segoe UI', 'sans-serif'],
              mono: ['JetBrains Mono', 'ui-monospace', 'SFMono-Regular', 'Menlo', 'monospace']
            }
          }
        }
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script>
      (function() {
        const saved = localStorage.getItem('twevals:theme');
        if (saved === 'light') document.documentElement.classList.remove('dark');
      })();
    </script>
  </head>
  <body class="min-h-screen bg-blue-50/40 font-sans text-zinc-800 dark:bg-neutral-950 dark:text-zinc-100">
    {% set status = result.result.status or 'completed' %}
    {% set pill_tones = {
      'pending': 'text-blue-300 bg-blue-500/10 border border-blue-500/40',
      'running': 'text-cyan-300 bg-cyan-500/10 border border-cyan-500/40',
      'completed': 'text-emerald-300 bg-emerald-500/10 border border-emerald-500/40',
      'error': 'text-rose-300 bg-rose-500/10 border border-rose-500/40',
      'cancelled': 'text-amber-300 bg-amber-500/10 border border-amber-500/40'
    } %}

    <div class="mx-auto w-full max-w-6xl px-4 py-6 md:px-6">
      <!-- Header -->
      <header class="mb-6 flex flex-wrap items-center justify-between gap-4 border-b border-blue-200/60 pb-6 dark:border-zinc-800">
        <div class="flex items-center gap-4">
          <a href="/?scroll={{ index }}" class="flex h-8 w-8 items-center justify-center rounded-lg text-zinc-500 transition hover:bg-blue-100 hover:text-blue-600 dark:hover:bg-zinc-800 dark:hover:text-blue-500" title="Back to table (Esc)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          </a>
          <div class="flex items-center gap-2 text-sm text-zinc-500">
            <a href="/" class="hover:text-blue-600">twevals</a>
            <span>›</span>
            {% if run_name %}<span class="text-zinc-600 dark:text-zinc-400">{{ run_name }}</span><span>›</span>{% endif %}
            <span class="text-zinc-700 dark:text-zinc-300">Result {{ index + 1 }} of {{ total }}</span>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <button id="prev-btn" class="flex h-8 w-8 items-center justify-center rounded-lg text-zinc-500 transition hover:bg-blue-100 hover:text-blue-600 disabled:opacity-30 disabled:cursor-not-allowed dark:hover:bg-zinc-800 dark:hover:text-blue-500" title="Previous (↑)" {% if index <= 0 %}disabled{% endif %}>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
          </button>
          <button id="next-btn" class="flex h-8 w-8 items-center justify-center rounded-lg text-zinc-500 transition hover:bg-blue-100 hover:text-blue-600 disabled:opacity-30 disabled:cursor-not-allowed dark:hover:bg-zinc-800 dark:hover:text-blue-500" title="Next (↓)" {% if index >= total - 1 %}disabled{% endif %}>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
          </button>
        </div>
      </header>

      <!-- Function header -->
      <div class="mb-6 flex flex-wrap items-center gap-3">
        <span class="font-mono text-xl font-semibold text-blue-600 dark:text-blue-500">{{ result.function }}</span>
        <span class="status-pill rounded px-2 py-0.5 text-xs font-medium {{ pill_tones.get(status, pill_tones.get('completed')) }}">{{ status }}</span>
        {% if result.result.latency is not none %}
          <span class="font-mono text-sm text-zinc-500">{{ result.result.latency | round(2) }}s</span>
        {% endif %}
      </div>

      <!-- Metadata row -->
      <div class="mb-6 flex flex-wrap items-center gap-6 text-sm">
        <div class="flex items-center gap-2">
          <span class="text-zinc-500">Dataset:</span>
          <span class="text-zinc-700 dark:text-zinc-300">{{ result.dataset or '—' }}</span>
        </div>
        {% if result.labels %}
        <div class="flex items-center gap-2">
          <span class="text-zinc-500">Labels:</span>
          <div class="flex gap-1">
            {% for la in result.labels %}<span class="rounded bg-blue-100 px-1.5 py-0.5 text-xs text-blue-700 dark:bg-zinc-800 dark:text-zinc-400">{{ la }}</span>{% endfor %}
          </div>
        </div>
        {% endif %}
        {% if result.result.error %}
        <div class="flex items-center gap-2">
          <span class="text-zinc-500">Error:</span>
          <span class="text-rose-600 dark:text-rose-400">{{ result.result.error }}</span>
        </div>
        {% endif %}
      </div>

      <!-- Data blocks -->
      <div class="mb-6 grid gap-4 lg:grid-cols-2">
        <div class="group">
          <div class="mb-2 flex items-center justify-between">
            <span class="text-xs font-medium uppercase tracking-wider text-zinc-500">Input</span>
            <button class="copy-btn flex h-6 w-6 items-center justify-center rounded text-zinc-400 opacity-0 transition hover:text-blue-600 group-hover:opacity-100 dark:text-zinc-600 dark:hover:text-blue-500" data-copy="pre-input">
              <svg class="copy-icon h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
              <svg class="check-icon hidden h-4 w-4 text-emerald-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
            </button>
          </div>
          <pre id="pre-input" class="max-h-64 overflow-auto rounded-lg border border-blue-200/60 bg-white px-4 py-3 font-mono text-sm text-zinc-700 dark:border-zinc-800/60 dark:bg-zinc-900/50 dark:text-zinc-300">{{ result.result.input }}</pre>
        </div>

        <div class="group">
          <div class="mb-2 flex items-center justify-between">
            <span class="text-xs font-medium uppercase tracking-wider text-zinc-500">Output</span>
            <button class="copy-btn flex h-6 w-6 items-center justify-center rounded text-zinc-400 opacity-0 transition hover:text-blue-600 group-hover:opacity-100 dark:text-zinc-600 dark:hover:text-blue-500" data-copy="pre-output">
              <svg class="copy-icon h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
              <svg class="check-icon hidden h-4 w-4 text-emerald-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
            </button>
          </div>
          <pre id="pre-output" class="max-h-64 overflow-auto rounded-lg border border-blue-200/60 bg-white px-4 py-3 font-mono text-sm dark:border-zinc-800/60 dark:bg-zinc-900/50 {% if result.result.error %}text-rose-600 dark:text-rose-400{% else %}text-zinc-700 dark:text-zinc-300{% endif %}">{% if result.result.output %}{{ result.result.output }}{% elif result.result.error %}{{ result.result.error }}{% else %}—{% endif %}</pre>
        </div>

        <div class="group">
          <div class="mb-2 flex items-center justify-between">
            <span class="text-xs font-medium uppercase tracking-wider text-zinc-500">Reference</span>
            <button class="copy-btn flex h-6 w-6 items-center justify-center rounded text-zinc-400 opacity-0 transition hover:text-blue-600 group-hover:opacity-100 dark:text-zinc-600 dark:hover:text-blue-500" data-copy="pre-ref">
              <svg class="copy-icon h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
              <svg class="check-icon hidden h-4 w-4 text-emerald-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
            </button>
          </div>
          <pre id="pre-ref" class="max-h-64 overflow-auto rounded-lg border border-blue-200/60 bg-white px-4 py-3 font-mono text-sm text-zinc-700 dark:border-zinc-800/60 dark:bg-zinc-900/50 dark:text-zinc-300">{{ result.result.reference or '—' }}</pre>
        </div>

        <div class="group">
          <div class="mb-2 flex items-center justify-between">
            <span class="text-xs font-medium uppercase tracking-wider text-zinc-500">Metadata</span>
            <button class="copy-btn flex h-6 w-6 items-center justify-center rounded text-zinc-400 opacity-0 transition hover:text-blue-600 group-hover:opacity-100 dark:text-zinc-600 dark:hover:text-blue-500" data-copy="pre-meta">
              <svg class="copy-icon h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
              <svg class="check-icon hidden h-4 w-4 text-emerald-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
            </button>
          </div>
          <pre id="pre-meta" class="max-h-64 overflow-auto rounded-lg border border-blue-200/60 bg-white px-4 py-3 font-mono text-sm text-zinc-700 dark:border-zinc-800/60 dark:bg-zinc-900/50 dark:text-zinc-300">{{ result.result.metadata or '—' }}</pre>
        </div>
      </div>

      <!-- Run Data -->
      {% if result.result.run_data is defined and result.result.run_data is not none %}
      <div class="mb-6 group">
        <div class="mb-2 flex items-center justify-between">
          <span class="text-xs font-medium uppercase tracking-wider text-zinc-500">Run Data</span>
          <button class="copy-btn flex h-6 w-6 items-center justify-center rounded text-zinc-400 opacity-0 transition hover:text-blue-600 group-hover:opacity-100 dark:text-zinc-600 dark:hover:text-blue-500" data-copy="pre-run">
            <svg class="copy-icon h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
            <svg class="check-icon hidden h-4 w-4 text-emerald-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
          </button>
        </div>
        <pre id="pre-run" class="max-h-96 overflow-auto rounded-lg border border-blue-200/60 bg-white px-4 py-3 font-mono text-sm text-zinc-700 dark:border-zinc-800/60 dark:bg-zinc-900/50 dark:text-zinc-300">{{ result.result.run_data | tojson(indent=2) }}</pre>
      </div>
      {% endif %}

      <!-- Scores -->
      {% if result.result.scores %}
      <div class="mb-6">
        <div class="mb-3 text-xs font-medium uppercase tracking-wider text-zinc-500">Scores</div>
        <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
          {% for s in result.result.scores %}
          <div class="flex items-center justify-between rounded-lg border border-blue-200/60 bg-white px-4 py-3 dark:border-zinc-800/60 dark:bg-zinc-900/50">
            <span class="font-mono text-sm text-zinc-700 dark:text-zinc-300">{{ s.key }}</span>
            <div class="flex items-center gap-3">
              {% if s.value is not none %}
                <span class="text-sm text-zinc-500 dark:text-zinc-400">{{ s.value }}</span>
              {% endif %}
              {% if s.passed is not none %}
                <span class="{% if s.passed %}text-emerald-600 dark:text-emerald-400{% else %}text-rose-600 dark:text-rose-400{% endif %} text-base">{{ '✓' if s.passed else '✗' }}</span>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Annotation -->
      <div class="mb-6">
        <div class="mb-3 text-xs font-medium uppercase tracking-wider text-zinc-500">Annotation</div>
        {% if result.result.annotation %}
        <div class="whitespace-pre-wrap rounded-lg border border-blue-200/60 bg-white px-4 py-3 text-sm text-zinc-700 dark:border-zinc-800/60 dark:bg-zinc-900/50 dark:text-zinc-300">{{ result.result.annotation }}</div>
        {% else %}
        <div class="text-sm text-zinc-400 dark:text-zinc-600">—</div>
        {% endif %}
      </div>

      <!-- Keyboard shortcuts hint -->
      <div class="mt-8 text-center text-xs text-zinc-400 dark:text-zinc-600">
        <kbd class="rounded border border-zinc-300 bg-zinc-100 px-1.5 py-0.5 font-mono dark:border-zinc-700 dark:bg-zinc-800">↑</kbd> /
        <kbd class="rounded border border-zinc-300 bg-zinc-100 px-1.5 py-0.5 font-mono dark:border-zinc-700 dark:bg-zinc-800">↓</kbd> navigate
        <span class="mx-2">·</span>
        <kbd class="rounded border border-zinc-300 bg-zinc-100 px-1.5 py-0.5 font-mono dark:border-zinc-700 dark:bg-zinc-800">Esc</kbd> back to table
      </div>
    </div>

    <script>
      const currentIndex = {{ index }};
      const total = {{ total }};
      const runId = '{{ run_id }}';

      // Navigation
      function navigateTo(idx) {
        if (idx >= 0 && idx < total) {
          window.location.href = `/runs/${runId}/results/${idx}`;
        }
      }

      document.getElementById('prev-btn')?.addEventListener('click', () => navigateTo(currentIndex - 1));
      document.getElementById('next-btn')?.addEventListener('click', () => navigateTo(currentIndex + 1));

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.target.matches('input, textarea, select')) return;
        if (e.key === 'ArrowUp') { e.preventDefault(); navigateTo(currentIndex - 1); }
        else if (e.key === 'ArrowDown') { e.preventDefault(); navigateTo(currentIndex + 1); }
        else if (e.key === 'Escape') { window.location.href = `/?scroll=${currentIndex}`; }
      });

      // Copy buttons
      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const targetId = btn.dataset.copy;
          const el = document.getElementById(targetId);
          if (!el) return;
          try {
            await navigator.clipboard.writeText(el.textContent);
            btn.querySelector('.copy-icon').classList.add('hidden');
            btn.querySelector('.check-icon').classList.remove('hidden');
            setTimeout(() => {
              btn.querySelector('.copy-icon').classList.remove('hidden');
              btn.querySelector('.check-icon').classList.add('hidden');
            }, 1500);
          } catch (err) {
            console.error('Copy failed:', err);
          }
        });
      });
    </script>
  </body>
</html>
